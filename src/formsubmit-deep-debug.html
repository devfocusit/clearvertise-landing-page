<!DOCTYPE html>
<html>
<head>
    <title>FormSubmit Deep Debug</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .test-card { background: white; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 16px; }
        button:hover { background: #0056b3; }
        input, textarea, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        textarea { height: 100px; resize: vertical; }
        .form-row { display: flex; gap: 15px; }
        .form-row > div { flex: 1; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        h1 { color: #333; text-align: center; }
        h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .endpoint-test { background: #e7f3ff; border-left: 4px solid #007bff; padding: 15px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>üîç FormSubmit Deep Debug Tool</h1>
    
    <!-- Environment Info -->
    <div class="test-card">
        <h2>üåç Environment Information</h2>
        <div id="envInfo"></div>
    </div>

    <!-- Test 1: Direct FormSubmit with Full Response Capture -->
    <div class="test-card">
        <h2>üß™ Test 1: JavaScript Form Submission (Full Debug)</h2>
        <p>This captures the complete FormSubmit response and shows you exactly what happens.</p>
        
        <form id="debugForm">
            <div class="form-row">
                <div>
                    <label>Name:</label>
                    <input type="text" name="name" value="Debug Test User" required>
                </div>
                <div>
                    <label>Email:</label>
                    <input type="email" name="email" value="debugtest@example.com" required>
                </div>
            </div>
            <label>Message:</label>
            <textarea name="message" required>This is a debug test message to check FormSubmit functionality.</textarea>
            
            <button type="submit">üöÄ Submit with Full Debug</button>
        </form>
        
        <div id="debugResults"></div>
    </div>

    <!-- Test 2: Multiple Endpoint Tests -->
    <div class="test-card">
        <h2>üéØ Test 2: Different FormSubmit Endpoints</h2>
        <p>Test different ways to submit to FormSubmit:</p>
        
        <div class="endpoint-test">
            <h3>A. Current Endpoint (el/fuhiha)</h3>
            <form action="https://formsubmit.co/el/fuhiha" method="POST" target="_blank">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_subject" value="Test A - Current Endpoint">
                <input type="text" name="name" value="Test A User" required>
                <input type="email" name="email" value="testa@example.com" required>
                <textarea name="message" required>Test A message</textarea>
                <button type="submit">Test Current Endpoint</button>
            </form>
        </div>

        <div class="endpoint-test">
            <h3>B. Direct Email Test</h3>
            <p>Enter your actual email to test direct submission:</p>
            <input type="email" id="testEmail" placeholder="your-email@domain.com" style="margin-bottom: 10px;">
            <form id="directEmailForm" method="POST" target="_blank">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_subject" value="Test B - Direct Email">
                <input type="text" name="name" value="Test B User" required>
                <input type="email" name="email" value="testb@example.com" required>
                <textarea name="message" required>Test B message to direct email</textarea>
                <button type="button" onclick="submitToDirectEmail()">Test Direct Email</button>
            </form>
        </div>

        <div class="endpoint-test">
            <h3>C. Alternative FormSubmit URL Format</h3>
            <form action="https://formsubmit.co/el/fuhiha" method="POST" target="_blank">
                <input type="hidden" name="_captcha" value="false">
                <input type="hidden" name="_subject" value="Test C - Alternative Format">
                <input type="hidden" name="_template" value="basic">
                <input type="text" name="name" value="Test C User" required>
                <input type="email" name="email" value="testc@example.com" required>
                <textarea name="message" required>Test C message with template</textarea>
                <button type="submit">Test Alternative Format</button>
            </form>
        </div>
    </div>

    <!-- Test 3: Network and CORS Test -->
    <div class="test-card">
        <h2>üåê Test 3: Network Connectivity & CORS</h2>
        <button onclick="runNetworkTests()">üîç Run Network Tests</button>
        <div id="networkResults"></div>
    </div>

    <!-- Test 4: Browser Console Information -->
    <div class="test-card">
        <h2>üñ•Ô∏è Test 4: Browser Information</h2>
        <button onclick="showBrowserInfo()">üìã Show Browser Info</button>
        <div id="browserInfo"></div>
    </div>

    <!-- Real-time Log -->
    <div class="test-card">
        <h2>üìù Real-time Log</h2>
        <button onclick="clearLogs()">üóëÔ∏è Clear Logs</button>
        <div id="logArea">Waiting for tests...</div>
    </div>

    <script>
        // Logging function
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `<strong>${timestamp}:</strong> ${message}`;
            logArea.appendChild(logEntry);
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logArea').innerHTML = 'Logs cleared...';
        }

        // Initialize environment info
        function initEnvironment() {
            const envInfo = document.getElementById('envInfo');
            const isLocal = window.location.protocol === 'file:' || 
                           window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1' ||
                           window.location.hostname === '';
            
            envInfo.innerHTML = `
                <div class="status ${isLocal ? 'error' : 'success'}">
                    <strong>Current URL:</strong> ${window.location.href}<br>
                    <strong>Protocol:</strong> ${window.location.protocol}<br>
                    <strong>Hostname:</strong> ${window.location.hostname}<br>
                    <strong>Port:</strong> ${window.location.port || 'default'}<br>
                    <strong>Testing Locally:</strong> ${isLocal ? 'YES - This will cause issues!' : 'NO - Good!'}
                </div>
            `;
            
            log(`Environment: ${isLocal ? 'Local (problematic)' : 'Live domain (good)'}`, isLocal ? 'warning' : 'success');
        }

        // Test 1: Debug form submission
        document.getElementById('debugForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const resultsDiv = document.getElementById('debugResults');
            resultsDiv.innerHTML = '<div class="status info">Submitting form with debug...</div>';
            
            try {
                const formData = new FormData(this);
                formData.append('_captcha', 'false');
                formData.append('_subject', 'Debug Test Submission');
                
                log('Starting debug form submission...', 'info');
                
                // Show what we're sending
                const dataObj = {};
                for (let [key, value] of formData.entries()) {
                    dataObj[key] = value;
                }
                resultsDiv.innerHTML += `
                    <div class="status info">
                        <h4>üì§ Data being sent:</h4>
                        <pre>${JSON.stringify(dataObj, null, 2)}</pre>
                    </div>
                `;
                
                const startTime = Date.now();
                const response = await fetch('https://formsubmit.co/el/fuhiha', {
                    method: 'POST',
                    body: formData
                });
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                log(`Response received in ${duration}ms`, 'success');
                
                // Response info
                resultsDiv.innerHTML += `
                    <div class="status ${response.ok ? 'success' : 'error'}">
                        <h4>üì® Response Information:</h4>
                        <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                        <strong>URL:</strong> ${response.url}<br>
                        <strong>Redirected:</strong> ${response.redirected}<br>
                        <strong>Response Time:</strong> ${duration}ms
                    </div>
                `;
                
                // Headers
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                resultsDiv.innerHTML += `
                    <div class="status info">
                        <h4>üìã Response Headers:</h4>
                        <pre>${JSON.stringify(headers, null, 2)}</pre>
                    </div>
                `;
                
                // Response body
                const responseText = await response.text();
                resultsDiv.innerHTML += `
                    <div class="status info">
                        <h4>üìÑ Response Body:</h4>
                        <pre>${responseText.substring(0, 500)}${responseText.length > 500 ? '...' : ''}</pre>
                    </div>
                `;
                
                // Analysis
                if (response.ok) {
                    if (responseText.includes('success') || responseText.includes('thank') || response.status === 200) {
                        log('‚úÖ SUCCESS: FormSubmit accepted the submission!', 'success');
                        resultsDiv.innerHTML += `
                            <div class="status success">
                                <h4>‚úÖ Analysis: SUCCESS!</h4>
                                <p>FormSubmit accepted your form submission. If you're not receiving emails:</p>
                                <ul>
                                    <li>Check your spam/junk folder</li>
                                    <li>Wait 5-10 minutes for delivery</li>
                                    <li>Verify the email associated with el/fuhiha endpoint</li>
                                </ul>
                            </div>
                        `;
                    } else {
                        log('‚ö†Ô∏è Unexpected response format', 'warning');
                    }
                } else {
                    log(`‚ùå ERROR: FormSubmit rejected submission (${response.status})`, 'error');
                }
                
            } catch (error) {
                log(`üö® NETWORK ERROR: ${error.message}`, 'error');
                resultsDiv.innerHTML += `
                    <div class="status error">
                        <h4>üö® Network Error:</h4>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>This usually indicates:</p>
                        <ul>
                            <li>CORS policy blocking the request</li>
                            <li>Network connectivity issues</li>
                            <li>FormSubmit servers are down</li>
                            <li>Browser security blocking the request</li>
                        </ul>
                    </div>
                `;
            }
        });

        // Direct email submission
        function submitToDirectEmail() {
            const email = document.getElementById('testEmail').value;
            if (!email) {
                log('‚ùå Please enter your email address first!', 'error');
                return;
            }
            
            const form = document.getElementById('directEmailForm');
            form.action = `https://formsubmit.co/${email}`;
            log(`Testing direct email submission to: ${email}`, 'info');
            form.submit();
        }

        // Network tests
        async function runNetworkTests() {
            const resultsDiv = document.getElementById('networkResults');
            resultsDiv.innerHTML = '<div class="status info">Running network tests...</div>';
            log('Starting network connectivity tests...', 'info');
            
            const tests = [
                { name: 'FormSubmit Main Site', url: 'https://formsubmit.co', method: 'HEAD' },
                { name: 'FormSubmit Endpoint', url: 'https://formsubmit.co/el/fuhiha', method: 'GET' },
                { name: 'Google (Control)', url: 'https://www.google.com', method: 'HEAD' },
                { name: 'HTTPS Test', url: 'https://httpbin.org/status/200', method: 'GET' }
            ];

            for (const test of tests) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(test.url, { 
                        method: test.method, 
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    resultsDiv.innerHTML += `
                        <div class="status success">
                            ‚úÖ ${test.name}: Reachable (${duration}ms)
                        </div>
                    `;
                    log(`‚úÖ ${test.name}: OK (${duration}ms)`, 'success');
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="status error">
                            ‚ùå ${test.name}: ${error.message}
                        </div>
                    `;
                    log(`‚ùå ${test.name}: ${error.message}`, 'error');
                }
            }
        }

        // Browser info
        function showBrowserInfo() {
            const browserInfo = document.getElementById('browserInfo');
            browserInfo.innerHTML = `
                <div class="status info">
                    <h4>üñ•Ô∏è Browser Information:</h4>
                    <strong>User Agent:</strong> ${navigator.userAgent}<br>
                    <strong>Platform:</strong> ${navigator.platform}<br>
                    <strong>Language:</strong> ${navigator.language}<br>
                    <strong>Cookie Enabled:</strong> ${navigator.cookieEnabled}<br>
                    <strong>Online:</strong> ${navigator.onLine}<br>
                    <strong>Screen:</strong> ${screen.width}x${screen.height}<br>
                    <strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}
                </div>
            `;
            log('Browser information displayed', 'info');
        }

        // Initialize on load
        window.addEventListener('load', function() {
            initEnvironment();
            log('Deep debug tool loaded and ready for testing', 'success');
        });
    </script>
</body>
</html>
