<!DOCTYPE html>
<html>
<head>
    <title>FormSubmit Diagnostic Tool</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { border: 1px solid #ddd; margin: 20px 0; padding: 20px; background: #f9f9f9; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
        textarea { height: 80px; resize: vertical; }
    </style>
</head>
<body>
    <h1>üîç FormSubmit Diagnostic Tool</h1>
    
    <div class="status info">
        <strong>Current Environment:</strong>
        <br>URL: <span id="currentUrl"></span>
        <br>Protocol: <span id="protocol"></span>
        <br>Domain: <span id="domain"></span>
        <br>Is Local: <span id="isLocal"></span>
    </div>

    <!-- Test 1: Basic FormSubmit -->
    <div class="test-section">
        <h2>üß™ Test 1: Basic FormSubmit (Same Window)</h2>
        <p>This will redirect the current page if successful.</p>
        <form id="test1" action="https://formsubmit.co/el/fuhiha" method="POST">
            <input type="text" name="name" placeholder="Your Name" value="Test User 1" required>
            <input type="email" name="email" placeholder="Your Email" value="test1@example.com" required>
            <textarea name="message" placeholder="Your Message" required>Test message from basic form</textarea>
            <button type="submit">üöÄ Send Test 1</button>
        </form>
    </div>

    <!-- Test 2: FormSubmit with New Window -->
    <div class="test-section">
        <h2>üß™ Test 2: FormSubmit (New Window)</h2>
        <p>This opens in a new window so you can see the response.</p>
        <form id="test2" action="https://formsubmit.co/el/fuhiha" method="POST" target="_blank">
            <input type="hidden" name="_subject" value="Test 2 - New Window Submission">
            <input type="text" name="name" placeholder="Your Name" value="Test User 2" required>
            <input type="email" name="email" placeholder="Your Email" value="test2@example.com" required>
            <textarea name="message" placeholder="Your Message" required>Test message from new window form</textarea>
            <button type="submit">üöÄ Send Test 2 (New Window)</button>
        </form>
    </div>

    <!-- Test 3: FormSubmit with Custom Redirect -->
    <div class="test-section">
        <h2>üß™ Test 3: FormSubmit with Custom Thank You Page</h2>
        <p>This redirects to a custom thank you page.</p>
        <form id="test3" action="https://formsubmit.co/el/fuhiha" method="POST">
            <input type="hidden" name="_next" value="https://formsubmit.co/thanks">
            <input type="hidden" name="_subject" value="Test 3 - Custom Redirect">
            <input type="hidden" name="_captcha" value="false">
            <input type="text" name="name" placeholder="Your Name" value="Test User 3" required>
            <input type="email" name="email" placeholder="Your Email" value="test3@example.com" required>
            <textarea name="message" placeholder="Your Message" required>Test message with custom redirect</textarea>
            <button type="submit">üöÄ Send Test 3 (Custom Redirect)</button>
        </form>
    </div>

    <!-- Test 4: Direct Email FormSubmit -->
    <div class="test-section">
        <h2>üß™ Test 4: Direct Email (No Hash)</h2>
        <p>Enter your actual email to test direct submission:</p>
        <form id="test4" method="POST" target="_blank">
            <input type="email" id="directEmail" placeholder="Enter your actual email" required>
            <input type="text" name="name" placeholder="Your Name" value="Test User 4" required>
            <input type="email" name="email" placeholder="Your Email" value="test4@example.com" required>
            <textarea name="message" placeholder="Your Message" required>Test message to direct email</textarea>
            <button type="button" onclick="submitDirectEmail()">üöÄ Send Test 4 (Direct Email)</button>
        </form>
    </div>

    <!-- Test 5: Network Request Test -->
    <div class="test-section">
        <h2>üß™ Test 5: Network Connectivity Test</h2>
        <p>Test if your browser can reach FormSubmit servers:</p>
        <button onclick="testNetworkConnectivity()">üåê Test Network Connection</button>
        <div id="networkResults"></div>
    </div>

    <!-- Status Log -->
    <div class="test-section">
        <h2>üìã Submission Log</h2>
        <div id="submissionLog">No submissions yet...</div>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
    </div>

    <script>
        // Initialize environment info
        document.getElementById('currentUrl').textContent = window.location.href;
        document.getElementById('protocol').textContent = window.location.protocol;
        document.getElementById('domain').textContent = window.location.hostname;
        
        const isLocal = window.location.protocol === 'file:' || 
                       window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1' ||
                       window.location.hostname === '';
        document.getElementById('isLocal').textContent = isLocal ? 'YES (This is likely the problem!)' : 'NO (Good!)';

        // Log function
        function logMessage(message, type = 'info') {
            const log = document.getElementById('submissionLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `<strong>${timestamp}:</strong> ${message}`;
            log.appendChild(logEntry);
            console.log(`[${timestamp}] ${message}`);
        }

        // Clear log function
        function clearLog() {
            document.getElementById('submissionLog').innerHTML = 'Log cleared...';
        }

        // Direct email submission
        function submitDirectEmail() {
            const email = document.getElementById('directEmail').value;
            if (!email) {
                logMessage('Please enter your email address first!', 'warning');
                return;
            }
            
            const form = document.getElementById('test4');
            form.action = `https://formsubmit.co/${email}`;
            logMessage(`Setting direct email action to: https://formsubmit.co/${email}`, 'info');
            form.submit();
        }

        // Network connectivity test
        async function testNetworkConnectivity() {
            const resultsDiv = document.getElementById('networkResults');
            resultsDiv.innerHTML = '<p>Testing network connectivity...</p>';
            
            const tests = [
                { name: 'FormSubmit Main Site', url: 'https://formsubmit.co' },
                { name: 'FormSubmit Endpoint', url: 'https://formsubmit.co/el/fuhiha' },
                { name: 'Google (Control Test)', url: 'https://www.google.com' }
            ];

            for (const test of tests) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(test.url, { 
                        method: 'HEAD', 
                        mode: 'no-cors',
                        cache: 'no-cache'
                    });
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    resultsDiv.innerHTML += `
                        <div class="status success">
                            ‚úÖ ${test.name}: Reachable (${duration}ms)
                        </div>
                    `;
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="status error">
                            ‚ùå ${test.name}: Failed - ${error.message}
                        </div>
                    `;
                }
            }
        }

        // Track all form submissions
        document.querySelectorAll('form').forEach((form, index) => {
            form.addEventListener('submit', function(e) {
                const formId = this.id || `form-${index + 1}`;
                const action = this.action;
                const method = this.method;
                const target = this.target || 'same window';
                
                logMessage(`Submitting ${formId} to ${action} (${method}) - Target: ${target}`, 'info');
                
                // For same-window submissions, warn about redirect
                if (!this.target || this.target === '_self') {
                    logMessage('‚ö†Ô∏è This will redirect the current page. Check browser network tab for the actual request.', 'warning');
                }
                
                // Log form data
                const formData = new FormData(this);
                const data = [];
                for (let [key, value] of formData.entries()) {
                    if (!key.startsWith('_')) { // Don't log hidden FormSubmit parameters
                        data.push(`${key}: ${value}`);
                    }
                }
                logMessage(`Form data: ${data.join(', ')}`, 'info');
            });
        });

        // Initial network test
        setTimeout(() => {
            logMessage('Page loaded. You can now test the forms above.', 'success');
            if (isLocal) {
                logMessage('üö® WARNING: You are testing locally. FormSubmit may not work with file:// protocol!', 'error');
            }
        }, 1000);
    </script>
</body>
</html>
